let gl_lFT=!1,productDetail={slideProduct:function(){let e=$("#sticky-image").find(".slide-step");if(!e.length)return;let t,i=null,a=e.find(".slide-lager"),o=a.find(".swiper-container"),n=e.find(".slide-thumb"),r=n.find(".swiper-container"),l=n.find(".thumb-item"),s=function(){image_active=t.activeIndex,i.slideTo(t.activeIndex),l.removeClass("is-active"),n.find('.thumb-item[data-target="'+t.activeIndex+'"]').addClass("is-active")};i=new Swiper(r,{navigation:{nextEl:n.find(".swiper-button-next"),prevEl:n.find(".swiper-button-prev")},preloadImages:!1,slidesPerView:4,spaceBetween:6,direction:"vertical",height:290,slideToClickedSlide:!0}),t=new Swiper(o,{preloadImages:!1,slidesPerView:1,spaceBetween:30,onTransitionStart:function(){s()}}),s(),n.on("click",".thumb-item",function(e){e.preventDefault(),t.slideTo($(this).data("target")),s()}),a.on("touchend",function(e){e.preventDefault(),i.slideTo(t.activeIndex),s()})},loadGallery:function(){if(gl_lFT){let e=$(".fotorama").on("fotorama:ready fotorama:show fotorama:showend fotorama:load fotorama:error fotorama:startautoplay fotorama:stopautoplay fotorama:fullscreenenter fotorama:fullscreenexit fotorama:loadvideo fotorama:unloadvideo",function(e,t,i){"fotorama:fullscreenexit"==e.type&&t.destroy()}).fotorama({click:!1,allowfullscreen:!0}).data("fotorama"),t=[];$(".lager-item").each(function(){t.push({img:$(this).data("max"),thumb:$(this).data("thumb")})}),console.log(t),e.load(t),e.show(image_active),e.requestFullScreen()}else $.getScript(base_url+"desktop/js/fotorama.js").done(function(){gl_lFT=!0,productDetail.loadGallery()})},stickyImage:function(){$("#sticky-image").sticky({topSpacing:5,zIndex:25,bottomSpacing:$("body").height()-$(".product-detail").height()-257})},stickyZoneBuy:function(){$(".product-detail").find("#zone-buy").sticky({topSpacing:0,zIndex:25,bottomSpacing:$("body").height()-$(".product-detail").height()-257})},loadSticky:function(){productDetail.stickyImage(),productDetail.stickyZoneBuy()},scrollProduct:function(){$('.product-nav a[href^="#"]').on("click",function(e){let t=$(this.getAttribute("href"));t.length&&($(".scroll-nav a").removeClass("active"),$(this).addClass("active"),e.preventDefault(),$("html, body").stop().animate({scrollTop:t.offset().top-120},300),console.log(t.offset().top-120))})},viewHistory:function(){new Swiper("#swiper-history",{slidesPerView:6,spaceBetween:0,slidesPerGroup:6,navigation:{nextEl:".history-next",prevEl:".history-prev"},on:{init:function(){console.log("swiper initialized History")}}})},logHistoryView:function(e){$.ajax({url:base_url+"customer/history/add",type:"POST",data:{product_id:e,_token:_token},dataType:"json",success:function(e){},error:function(e,t,i){console.log(i+"\r\n"+e.statusText+"\r\n"+e.responseText)}})},productSimilar:function(){$.ajax({url:base_url+"product/similar",type:"post",data:{_token:_token,product_id:product_id,vendor:vendor,brand:brand},dataType:"json",success:function(e){""!=e.html?($("#zone-bought").html(e.html),$(".elm_similar").show(),productDetail.viewSimilar(),Vnit.lazyLoader()):$(".elm_similar").hide()},error:function(e,t,i){console.log(i+"\r\n"+e.statusText+"\r\n"+e.responseText)}})},viewSimilar:function(){new Swiper("#swiper-similar",{slidesPerView:4,spaceBetween:0,slidesPerGroup:4,navigation:{nextEl:".similar-next",prevEl:".similar-prev"},on:{init:function(){console.log("swiper initialized Similar")}}})},Init:function(){productDetail.productSimilar(),productDetail.slideProduct(),productDetail.loadSticky(),productDetail.scrollProduct(),productDetail.viewHistory(),productDetail.logHistoryView(product_id),Vnit.showMoreContent("#js-description"),Vnit.lazyLoader()}};$(document).ready(function(){productDetail.Init(),$("#js-description img").each(function(){$(this).removeClass().addClass("img-fluid lazy")}),$(".share-control").hover(function(){$(".share-content").show()},function(){$(".share-content").hide()})});let productEbay={ebayOption:function(){let e={};$(".msku-sel").change(function(){let t=$(this);if("Color"==t.data("name")||"Colors"==t.data("name")){let i=t.find(":selected").data("text");e=color_pic[i]?color_pic[i]:images_list}t.prop("selected",!0);let a=[],o=[],n=$(this).attr("name"),r=$(this).val(),l=$(this).attr("id");for(let e=0;e<Object.keys(menu).length;e++){let t=Object.keys(menu)[e];menu[t].traitValuesMap[n]==r&&a.push(t)}for(k=0;k<a.length;k++)for(i=0;i<menuItemMap.length;i++){let e=menuItemMap[i];in_array(a[k],e.matchingVariationIds)&&(in_array(e.valueId,o)||o.push(e.valueId))}let s={};$(".msku-sel").each(function(){let e=$(this),t=e.attr("id"),a=e.attr("name");for("-1"==r?(e.find("option").each(function(){$(this).prop("selected",!1),$(this).removeAttr("hidden")}),$("[name=price_key]").val("")):(l!=t&&e.find("option").each(function(){let e=$(this).val();-1!=e?in_array(e,o)?($(this).removeAttr("hidden"),$("[name=price_key]").val("")):($(this).attr("hidden","hidden"),$(this).prop("selected",!1)):$("[name=price_key]").val("")}),e.find("option:selected")&&(-1!=e.find("option:selected").val()?s[a]=parseInt(e.find("option:selected").val()):$("[name=price_key]").val(""))),i=0;i<Object.keys(menu).length;i++){key=Object.keys(menu)[i],item=menu[key],equals(item.traitValuesMap,s)&&(select_menu=item,$("[name=price_key]").val(key),console.log(select_menu),console.log(key))}});let d=0;if(select_menu.qty&&select_menu.qty>0){d=select_menu.qty-select_menu.sold,$("#qty_available").text(d),$("#qty_sold").text(select_menu.sold),$("#current_price").text(number_format(select_menu.price_convert,0,".",","));let e='<option value="0">Số lượng</option>';for(i=1;i<=d;i++)e+='<option value="'+i+'">'+i+"</option>";$("#qty").html(e),d<=0?($("#qty").prop("disabled",!0),$(".buy-now, .add-cart").prop("disabled",!0),$(".product-qty-warning").show()):($("#qty").prop("disabled",!1),$(".buy-now, .add-cart").prop("disabled",!1),$(".product-qty-warning").hide())}else{d=0,$("#qty_available").text(d),$("#qty_sold").text(select_menu.sold);let e='<option value="0">Số lượng</option>';$("#qty").html(e),d<=0?($("#qty").prop("disabled",!0),$(".add-cart").prop("disabled",!0),$(".product-qty-warning").show()):($("#qty").prop("disabled",!1),$(".add-cart").prop("disabled",!1),$(".product-qty-warning").hide())}if(e&&Object.keys(e).length>0){for($(".slide-lager .swiper-wrapper").html(""),$(".slide-thumb .swiper-wrapper").html(""),i=0;i<Object.keys(e).length;i++)$(".slide-thumb .swiper-wrapper").append('<div class="swiper-slide"><div class="thumb-item" data-target="'+i+'"><img src="'+e[i]+'" class="img-fluid owl-lazy" data-src="'+e[i]+'"></div></div>'),$(".slide-lager .swiper-wrapper").append('<div class="swiper-slide"><a href="javascript:;" class="lager-inner"><div href="'+e[i]+'" class="lager-item" data-max="'+e[i]+'"  data-thumb="'+e[i]+'"><img src="'+e[i]+'" class="img-fluid owl-lazy" data-src="'+e[i]+'"></div></a></div>');productDetail.slideProduct()}})},Init:function(){productEbay.ebayOption()}};$(document).ready(function(){productEbay.Init()});